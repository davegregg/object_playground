<!DOCTYPE html>
<html>
<head>
    <title></title>

    <script type="text/javascript" src="shims/typedarray.js"></script>    <!-- Int32Array support for IE9 -->
    <script type="text/javascript" src="viz/viz.js"></script>

    <script type="text/javascript" src="object_node.js"></script>
    <script type="text/javascript" src="object_graph.js"></script>
    <script type="text/javascript" src="viz_visualizer.js"></script>

</head>
<body>

<script>

  function inspect(s) {
    return "<pre>" + s.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\"/g, "&quot;") + "</pre>"
  }

  function src(id) {
      function Five(prefix) {
          this.myFive = prefix + "" + 5;
      }
      Five.prototype.sayFive = function() {
          console.log("sayFive: " + this.myFive);
      };

      function Six(prefix) {
          Five.call(this, prefix);
          this.mySix = 6 + "" + prefix;
      }
      Six.prototype = new Five("xxx");
      Six.prototype.constructor = Six;
      Six.prototype.sayFive = function() {
          Five.prototype.sayFive.call(this);
          console.log("sayFive child!");
      }
      Six.prototype.saySix = function() {
          console.log("saySix: " + this.mySix);
      };

      function create(parent) {
          function F() {}
          F.prototype = parent;
          return new F();
      }

      var sevenParent = { "seven": 7 }
      var seven = create(sevenParent);

      INPUT = {
          a: 1,
          b: "two",
          c: function three() {},
          d: { four: 4 },
          e: null,
          f: undefined,
          g: NaN,
          h: new Five("A"),
          i: new Six("B"),
          i2: new Six("C"),
          j: [7, 8, 9],
          k: seven
      };


      var context = {};
      var playground = "this.stuff = INPUT";

//      playground = "with (this) { " + playground + " }";
      (new Function(playground)).call(context);
//      eval.call(context, playground);

      var objectGraph = new jdls.ObjectGraph("this", context);
//      objectGraph = new jdls.ObjectGraph("input", objectGraph);

      return jdls.viz.details.graphToViz(objectGraph);
  }
  function example(id, format) {
    var result;
    try {
      result = Viz(src(id), format);
      if (format === "svg")
        return result;
      else
        return inspect(result);
    } catch(e) {
      return inspect(e.toString());
    }
  }

  document.body.innerHTML += example("data", "svg");

</script>

</body>
</html>